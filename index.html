<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–ù–∞–º–æ–∑ –≤–∞“õ—Ç–ª–∞—Ä–∏</title>
  <style>
    :root{
      --bg:#eef2f7;
      --card:#ffffff;
      --text:#0b1623;
      --muted:#6b7280;
      --accent:#007bff;
    }
    [data-theme="dark"]{
      --bg:#0b1020;
      --card:#131b2e;
      --text:#e6eef8;
      --muted:#9aa6bf;
      --accent:#00aaff;
    }
    *{box-sizing:border-box;font-family:'Inter', 'Segoe UI', Arial, sans-serif;transition:all .3s ease}
    body{margin:0;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .app{width:100%;max-width:920px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:20px}
    h1{font-size:24px;font-weight:700;margin:0;color:var(--accent)}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    button,select{padding:8px 12px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:var(--card);cursor:pointer;font-weight:500}
    button:hover,select:hover{background:var(--accent);color:#fff;border-color:var(--accent)}
    .card{background:var(--card);padding:20px;border-radius:16px;box-shadow:0 8px 25px rgba(0,0,0,0.08)}
    .location{display:flex;gap:8px;align-items:center;font-weight:500;color:var(--accent)}
    .times{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-top:16px}
    .time-row{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-radius:10px;background:rgba(0,0,0,0.03)}
    .time-row:hover{background:rgba(0,0,0,0.07)}
    .next{font-weight:700;font-size:20px;color:var(--accent)}
    .muted{color:var(--muted);font-size:14px}
    footer{margin-top:16px;display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--muted)}
    .calendar{margin-top:18px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:6px;text-align:center;border:1px solid rgba(0,0,0,0.05)}
    th{background:rgba(0,0,0,0.05)}
    td div:first-child{font-weight:600;color:var(--accent)}
    .theme-toggle,.lang-toggle{cursor:pointer;padding:6px 10px;border-radius:8px;background:var(--accent);color:#fff;border:none}
    @media(max-width:640px){header{flex-direction:column;align-items:flex-start}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>–ù–∞–º–æ–∑ –≤–∞“õ—Ç–ª–∞—Ä–∏</h1>
        <div class="muted">GPS —ë—Ä–¥–∞–º–∏–¥–∞ –∞–Ω–∏“õ–ª–∞–Ω–∞–¥–∏ —ë–∫–∏ “õ—û–ª –±–∏–ª–∞–Ω –∫–∏—Ä–∏—Ç–∏—à –º—É–º–∫–∏–Ω</div>
      </div>
      <div class="controls">
        <select id="methodSelect">
          <option value="MWL">Muslim World League</option>
          <option value="ISNA">ISNA</option>
          <option value="Egypt">Egyptian Authority</option>
          <option value="Makkah">Umm al-Qura (Makka)</option>
          <option value="Karachi">Karachi University</option>
          <option value="Tehran">Tehran Institute</option>
        </select>
        <button id="gpsBtn">üìç GPS –æ—Ä“õ–∞–ª–∏</button>
        <button id="manualBtn">‚úèÔ∏è “ö—û–ª –±–∏–ª–∞–Ω</button>
        <button class="theme-toggle" id="themeBtn">üåô</button>
      </div>
    </header>

    <div class="card">
      <div class="location" id="locInfo">–ñ–æ–π–ª–∞—à—É–≤ –∞–Ω–∏“õ–ª–∞–Ω–º–æ“õ–¥–∞...</div>
      <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="next" id="nextPrayer">–ö–µ–ª–∞—Å–∏ –Ω–∞–º–æ–∑:</div>
          <div class="muted" id="countdown">...</div>
        </div>
        <div style="text-align:right">
          <div class="muted" id="todayDate"></div>
          <div class="muted" id="timezone"></div>
        </div>
      </div>

      <div class="times" id="timesList"></div>

      <div class="calendar card" id="calendar">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="muted" id="monthLabel"></div>
          <div>
            <button id="prevMonth">‚óÄ</button>
            <button id="nextMonth">‚ñ∂</button>
          </div>
        </div>
        <div id="monthTable" style="margin-top:8px"></div>
      </div>

      <footer>
        <div>üá∫üáø –õ–æ–π–∏“≥–∞: –ù–∞–º–æ–∑ –≤–∞“õ—Ç–ª–∞—Ä–∏ ‚Äî GPS –∞—Å–æ—Å–∏–¥–∞</div>
        <div>–ê–∑–æ–Ω –æ–≤–æ–∑–∏–Ω–∏ —ë“õ–∏—à <input type="checkbox" id="azanChk"></div>
      </footer>
    </div>

    <div id="manualModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center">
      <div style="background:var(--card);padding:18px;border-radius:12px;max-width:420px;width:100%">
        <h3>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–ª–∞—Ä–Ω–∏ –∫–∏—Ä–∏—Ç–∏—à</h3>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="latInput" placeholder="–ö–µ–Ω–≥–ª–∏–∫ (lat)" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
          <input id="lonInput" placeholder="–£–∑—É–Ω–ª–∏–∫ (lon)" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
        </div>
        <div style="margin-top:8px;display:flex;justify-content:flex-end;gap:8px">
          <button id="cancelManual">–ë–µ–∫–æ—Ä “õ–∏–ª–∏—à</button>
          <button id="saveManual">–°–∞“õ–ª–∞—à</button>
        </div>
      </div>
    </div>
  </div>

<script>
// –ù–∞–º–æ–∑ –≤–∞“õ—Ç–ª–∞—Ä–∏–Ω–∏ “≥–∏—Å–æ–±–ª–∞—à –≤–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —è—Ä–∞—Ç–∏—à (“õ–∏—Å“õ–∞—Ä—Ç–∏—Ä–∏–ª–≥–∞–Ω –≤–µ—Ä—Å–∏—è)
var PrayTimes=function(){var methodParams={MWL:{fajr:18,isha:17},ISNA:{fajr:15,isha:15},Egypt:{fajr:19.5,isha:17.5},Makkah:{fajr:18.5,isha:'90min'},Karachi:{fajr:18,isha:18},Tehran:{fajr:17.7,isha:14}};function toRad(d){return d*Math.PI/180}function toDeg(d){return d*180/Math.PI}function fix(a){return a-360*Math.floor(a/360)}function jd(y,m,d){if(m<=2){y-=1;m+=12}var A=Math.floor(y/100);var B=2-A+Math.floor(A/4);return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+B-1524.5}function sun(jd_){var D=jd_-2451545.0;var g=fix(357.529+0.98560028*D);var q=fix(280.459+0.98564736*D);var L=fix(q+1.915*Math.sin(toRad(g))+0.020*Math.sin(toRad(2*g)));var e=23.439-0.00000036*D;var RA=toDeg(Math.atan2(Math.cos(toRad(e))*Math.sin(toRad(L)),Math.cos(toRad(L))))/15;var decl=toDeg(Math.asin(Math.sin(toRad(e))*Math.sin(toRad(L))));var eqt=q/15-RA;return{decl:decl,eqt:eqt}}function hAngle(h,lat,dec){var t=(Math.sin(toRad(h))-Math.sin(toRad(lat))*Math.sin(toRad(dec)))/(Math.cos(toRad(lat))*Math.cos(toRad(dec)));t=Math.min(Math.max(t,-1),1);return toDeg(Math.acos(t))/15}function compute(date,lat,lng,zone,method){var y=date.getFullYear(),m=date.getMonth()+1,d=date.getDate();var JD=jd(y,m,d);var D=sun(JD);var noon=12-D.eqt-lng/15+zone;var p=methodParams[method]||methodParams.MWL;var fajrH=hAngle(-p.fajr,lat,D.decl);var ishaH=(typeof p.isha==='string')?parseFloat(p.isha)/60:hAngle(-p.isha,lat,D.decl);var sunriseH=hAngle(-0.833,lat,D.decl);return{fajr:noon-fajrH,sunrise:noon-sunriseH,dhuhr:noon,asr:noon+1.5,sunset:noon+sunriseH,maghrib:noon+sunriseH,isha:(typeof p.isha==='string')?(noon+sunriseH+parseFloat(p.isha)/60):noon+ishaH}}function toTime(t){t=(t+24)%24;var h=Math.floor(t),m=Math.floor((t-h)*60+0.5);if(m>=60){h++;m=0}return(h<10?'0'+h:h)+":"+(m<10?'0'+m:m)}return{get:function(d,c,z,m){var r=compute(d,c.lat,c.lng,z,m),o={};for(var k in r)o[k]=toTime(r[k]);return o}}}();

const el={loc:document.getElementById('locInfo'),times:document.getElementById('timesList'),gps:document.getElementById('gpsBtn'),manual:document.getElementById('manualBtn'),lat:document.getElementById('latInput'),lon:document.getElementById('lonInput'),save:document.getElementById('saveManual'),cancel:document.getElementById('cancelManual'),modal:document.getElementById('manualModal'),next:document.getElementById('nextPrayer'),count:document.getElementById('countdown'),date:document.getElementById('todayDate'),zone:document.getElementById('timezone'),method:document.getElementById('methodSelect'),monthLabel:document.getElementById('monthLabel'),monthTable:document.getElementById('monthTable'),prevMonth:document.getElementById('prevMonth'),nextMonth:document.getElementById('nextMonth'),theme:document.getElementById('themeBtn'),azan:document.getElementById('azanChk')}

const state={lat:null,lng:null,zone:0,method:'MWL',monthOffset:0,azan:false}

el.theme.onclick=()=>{document.documentElement.toggleAttribute('data-theme','dark')}

document.getElementById('methodSelect').onchange=e=>{state.method=e.target.value;render()}
el.azan.onchange=e=>state.azan=e.target.checked

el.gps.onclick=()=>{el.loc.textContent='GPS –∞–Ω–∏“õ–ª–∞–Ω–º–æ“õ–¥–∞...';navigator.geolocation.getCurrentPosition(p=>{state.lat=p.coords.latitude;state.lng=p.coords.longitude;state.zone=-new Date().getTimezoneOffset()/60;render()},()=>el.loc.textContent='GPS –∞–Ω–∏“õ–ª–∞–Ω–º–∞–¥–∏')}

el.manual.onclick=()=>el.modal.style.display='flex'
el.cancel.onclick=()=>el.modal.style.display='none'
el.save.onclick=()=>{const a=parseFloat(el.lat.value),b=parseFloat(el.lon.value);if(!isNaN(a)&&!isNaN(b)){state.lat=a;state.lng=b;state.zone=-new Date().getTimezoneOffset()/60;el.modal.style.display='none';render()}}

function render(){if(!state.lat)return;const d=new Date(),times=PrayTimes.get(d,{lat:state.lat,lng:state.lng},state.zone,state.method);const order=['fajr','sunrise','dhuhr','asr','maghrib','isha'];const names={fajr:'–ë–æ–º–¥–æ–¥',sunrise:'“ö—É—ë—à —á–∏“õ–∏—à–∏',dhuhr:'–ü–µ—à–∏–Ω',asr:'–ê—Å—Ä',maghrib:'–®–æ–º',isha:'–•—É—Ñ—Ç–æ–Ω'};el.loc.textContent=`–ö–µ–Ω–≥–ª–∏–∫: ${state.lat.toFixed(3)}, –£–∑—É–Ω–ª–∏–∫: ${state.lng.toFixed(3)}`;el.date.textContent=d.toLocaleDateString('uz-UZ',{weekday:'long',day:'numeric',month:'long',year:'numeric'});el.zone.textContent='UTC'+(state.zone>=0?'+':'')+state.zone;el.times.innerHTML='';order.forEach(k=>{const div=document.createElement('div');div.className='time-row';div.innerHTML=`<div>${names[k]}</div><div>${times[k]}</div>`;el.times.appendChild(div)});renderCalendar(d);}

function renderCalendar(base){const d=new Date(base.getFullYear(),base.getMonth()+state.monthOffset,1);const days=new Date(d.getFullYear(),d.getMonth()+1,0).getDate();el.monthLabel.textContent=d.toLocaleString('uz-UZ',{month:'long',year:'numeric'});let html='<table><thead><tr><th>–î—É</th><th>–°–µ</th><th>–ß–æ</th><th>–ü–∞</th><th>–ñ—É</th><th>–®–∞</th><th>–Ø–∫</th></tr></thead><tbody><tr>';let start=new Date(d.getFullYear(),d.getMonth(),1).getDay();start=(start==0?6:start-1);for(let i=0;i<start;i++)html+='<td></td>';for(let day=1;day<=days;day++){const cur=new Date(d.getFullYear(),d.getMonth(),day);const t=PrayTimes.get(cur,{lat:state.lat,lng:state.lng},state.zone,state.method);if((start+day-1)%7==0&&day!=1)html+='</tr><tr>';html+=`<td><div>${day}</div><div>${t.fajr} | ${t.maghrib}</div></td>`;}html+='</tr></tbody></table>';el.monthTable.innerHTML=html;}

el.prevMonth.onclick=()=>{state.monthOffset--;render()}
el.nextMonth.onclick=()=>{state.monthOffset++;render()}

navigator.geolocation.getCurrentPosition(p=>{state.lat=p.coords.latitude;state.lng=p.coords.longitude;state.zone=-new Date().getTimezoneOffset()/60;render()},()=>el.loc.textContent='–ñ–æ–π –∞–Ω–∏“õ–ª–∞–Ω–º–∞–¥–∏')
</script>
</body>
</html>
